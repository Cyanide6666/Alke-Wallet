<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transacciones - ALKE Wallet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --alke-primary: #d1aac9;
            --alke-secondary: #f782d0;
            --alke-dark: #b283e7;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .transactions-card {
            background: linear-gradient(135deg, #faf8fa 0%, #eeace0 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin: 50px auto;
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--alke-primary);
            font-size: 1.2rem;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .wallet-header {
            text-align: center;
            margin-bottom: 10px;
        }

        .wallet-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--alke-primary) 15%, var(--alke-secondary) 90%, var(--alke-dark) 100%);
            -webkit-background-clip: text;
            background-clip: transparent;
            -webkit-text-fill-color: transparent;
        }

        .logo-image {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            object-fit: contain;
        }

        .balance-info {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .transaction-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            margin: 10px 0;
            background: white;
            transition: all 0.3s ease;
        }

        .transaction-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .transaction-icon {
            font-size: 1.8rem;
            margin-right: 15px;
            width: 50px;
            text-align: center;
        }

        .transaction-details {
            flex: 1;
        }

        .transaction-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .transaction-date {
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .amount-positive {
            color: #27ae60;
        }

        .amount-negative {
            color: #e74c3c;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            flex: 1;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: var(--alke-primary);
            color: white;
            border-color: var(--alke-primary);
        }

        .filter-btn:hover {
            background: var(--alke-primary);
            color: white;
            border-color: var(--alke-primary);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--alke-primary);
        }

        .transactions-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <div class="transactions-card">
        <button class="back-btn" onclick="goToMenu()">
            <i class="bi bi-arrow-left"></i> Volver al Menú
        </button>

        <div class="wallet-header text-center">
            <div class="d-flex align-items-center justify-content-center mb-3">
                <span class="logo-text">ALKE Wallet</span>
                <img src="https://media1.giphy.com/media/v1.Y2lkPTZjMDliOTUyY2Y1amgxdTIwOWhpa254dDd5OW5ibGpyb3R4aWFqZ3Z6dWgwOW9zNiZlcD12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/EGNi09y1CXeyA/200.gif" 
                alt="mymelody-logo" class="logo-image ms-3">
            </div>

            <h4>Últimos Movimientos</h4>
            <p class="text-muted">Historial de transacciones</p>
        </div>

        <!-- Información del saldo -->
        <div class="balance-info">
            <h6>Saldo disponible</h6>
            <h4 id="currentBalance">$0</h4>
        </div>

        <!-- Filtros -->
        <div class="filter-buttons">
            <button class="filter-btn active" onclick="filterTransactions('all')">
                Todas
            </button>
            <button class="filter-btn" onclick="filterTransactions('deposit')">
                Ingresos
            </button>
            <button class="filter-btn" onclick="filterTransactions('send')">
                Envíos
            </button>
        </div>

        <!-- Lista de transacciones -->
        <div class="transactions-list" id="transactionsList">
            <!-- Las transacciones se cargarán aquí dinámicamente -->
        </div>
    </div>

    <script>
        let currentBalance = 0;
        let allTransactions = [];
        let filteredTransactions = [];

        // Función para volver al menú
        function goToMenu() {
            window.location.href = 'menu.html';
        }

        // Función para formatear fecha
        function formatDate(dateString) {
            const options = { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateString).toLocaleDateString('es-ES', options);
        }

        // Función para obtener icono según tipo de transacción
        function getTransactionIcon(type) {
            switch(type) {
                case 'deposit':
                    return '<i class="bi bi-plus-circle text-success"></i>';
                case 'send':
                    return '<i class="bi bi-arrow-up-right text-danger"></i>';
                default:
                    return '<i class="bi bi-arrow-left-right text-primary"></i>';
            }
        }

        // Función para obtener descripción según tipo de transacción
        function getTransactionDescription(transaction) {
            switch(transaction.type) {
                case 'deposit':
                    return 'Depósito a tu cuenta';
                case 'send':
                    return `Envío a ${transaction.contact || 'contacto'}`;
                default:
                    return 'Transacción';
            }
        }

        // Función para cargar transacciones
        function loadTransactions() {
            const transactionsList = document.getElementById('transactionsList');
            
            if (filteredTransactions.length === 0) {
                transactionsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="bi bi-receipt"></i>
                        </div>
                        <h5>No hay transacciones</h5>
                        <p>Aquí aparecerán tus movimientos recientes</p>
                    </div>
                `;
                return;
            }

            transactionsList.innerHTML = '';

            filteredTransactions.forEach(transaction => {
                const transactionItem = document.createElement('div');
                transactionItem.className = 'transaction-item';
                
                const isDeposit = transaction.type === 'deposit';
                const amountClass = isDeposit ? 'amount-positive' : 'amount-negative';
                const amountSign = isDeposit ? '+' : '-';
                const comentario = transaction.comentario || transaction.concept || '';

                transactionItem.innerHTML = `
                    <div class="transaction-icon">
                        ${getTransactionIcon(transaction.type)}
                    </div>
                    <div class="transaction-details">
                        <div class="transaction-name">
                            ${getTransactionDescription(transaction)}
                        </div>
                        <div class="transaction-date">
                            ${formatDate(transaction.date)}
                        </div>
                        ${comentario ? `<small class="text-muted">${comentario}</small>` : ''}
                    </div>
                    <div class="transaction-amount ${amountClass}">
                        ${amountSign}$${transaction.amount.toLocaleString()}
                    </div>
                `;
                
                transactionsList.appendChild(transactionItem);
            });
        }

        // Función para filtrar transacciones
        function filterTransactions(type) {
            // Actualizar botones activos
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            // Filtrar transacciones
            if (type === 'all') {
                filteredTransactions = [...allTransactions];
            } else {
                filteredTransactions = allTransactions.filter(t => t.type === type);
            }

            // Ordenar por fecha (más reciente primero)
            filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            loadTransactions();
        }

        // Función para cargar datos iniciales
        function loadInitialData() {
            // Cargar saldo
            const savedBalance = localStorage.getItem('alkeWalletBalance');
            if (savedBalance) {
                currentBalance = parseInt(savedBalance);
                document.getElementById('currentBalance').textContent = `$${currentBalance.toLocaleString()}`;
            } else {
                currentBalance = 21050;
                localStorage.setItem('alkeWalletBalance', currentBalance.toString());
                document.getElementById('currentBalance').textContent = `$${currentBalance.toLocaleString()}`;
            }

            // Cargar transacciones
            const savedTransactions = localStorage.getItem('alkeWalletTransactions');
            if (savedTransactions) {
                allTransactions = JSON.parse(savedTransactions);
            } else {
                // Transacciones de ejemplo
                allTransactions = [
                    {
                        id: 1,
                        type: 'deposit',
                        amount: 50000,
                        date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                        comentario: 'Depósito inicial'
                    },
                    {
                        id: 2,
                        type: 'send',
                        amount: 15000,
                        contact: 'Kitty',
                        date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                        comentario: 'Pago de servicios'
                    },
                    {
                        id: 3,
                        type: 'deposit',
                        amount: 25000,
                        date: new Date().toISOString(),
                        comentario: 'Recarga de saldo'
                    }
                ];
                localStorage.setItem('alkeWalletTransactions', JSON.stringify(allTransactions));
            }

            // Mostrar todas las transacciones inicialmente
            filterTransactions('all');
        }

        // Volver atrás con Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                goToMenu();
            }
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            loadInitialData();
        });
    </script>
</body>
</html>